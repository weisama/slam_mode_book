# 快速入门使用2d版定位模块，以及简单测试其功能

## 1.接线介绍

印有logo为模块顶面，侧面网口用于连接雷达，接XH2.54mm插头用于5V供电和输出坐标

<table>
  <tr>
    <td style="border: 10px solid black; padding: 0;">
      <img src="https://github.com/user-attachments/assets/b9553eba-3740-4190-be2b-99df2072b014" width="100%">
    </td>
  </tr>
</table>

**供电电压为5V直流**

## 2.使用上位机

[下载上位机最新版](https://github.com/kikiYang03/SerialPortAssistant3D/releases)

**选择最新版下载**

<table>
  <tr>
    <td style="border: 10px solid black; padding: 0;">
      <img src="https://github.com/user-attachments/assets/53683e29-07c5-48a2-be6e-efc71da73c13" width="80%">
    </td>
  </tr>
</table>

模块接线如图：

<table>
  <tr>
    <td style="border: 10px solid black; padding: 0;">
      <img src="https://github.com/user-attachments/assets/e113c383-4b0a-47ef-98d5-7ee1083a8c50" width="100%">
    </td>
  </tr>
</table>

上电后，等待模块初始化10s，连接模块热点（密码12345678）：

<table>
  <tr>
    <td style="border: 10px solid black; padding: 0;">
      <img src="https://github.com/user-attachments/assets/571f7fb4-060f-425d-a219-6a3532111917" width="200%">
    </td>
  </tr>
</table>

**模块出厂默认：雷达类型为MID360，雷达水平放置机器人顶部朝前，输出方式为串口输出**

**非默认情况请先设置一次模块参数，详细可见进阶使用**

启动上位机，点击[打开连接]，连接成功后可以看见上位机收到大量数据：

<table>
  <tr>
    <td style="border: 10px solid black; padding: 0;">
      <img src="https://github.com/user-attachments/assets/b0fe5423-52bf-43c5-8332-279a870c3d77" width="80%">
    </td>
  </tr>
</table>

点击[发送测试数据]，模块成功测试成功：

<table>
  <tr>
    <td style="border: 10px solid black; padding: 0;">
      <img src="https://github.com/user-attachments/assets/4eb31435-bb1d-48d7-a418-96a01b1c0723" width="80%">
    </td>
  </tr>
</table>

进入可视化界面，可以看见机器人坐标，箭头代表机器人，蓝色点为雷达实时点云，彩色点为雷达建图

**坐标轴遵循ENU，上电时以机器人朝向建立坐标轴，红色坐标轴（机器人前方）为X+方向，绿色坐标轴（机器人左方）为Y+方向，蓝色坐标轴（机器人上方）为Z+方向**

**姿态角yaw：模块启动时以X+为0度，向右顺时针转动范围0到-180度，向左逆时针转动范围0到180度；pitch，roll同理**

<table>
  <tr>
    <td style="border: 10px solid black; padding: 0;">
      <img src="https://github.com/user-attachments/assets/138d3de9-65e6-4b36-9b97-0d1f37dd6b0b" width="80%">
    </td>
  </tr>
</table>

<table>
  <tr>
    <td style="border: 10px solid black; padding: 0;">
      <img src="https://github.com/user-attachments/assets/6607b8ac-2bd4-4315-afab-6f43d2729af7" width="100%">
    </td>
  </tr>
</table>

机器人围绕房间一圈，可以看见蓝色曲线为机器人行驶路径，建图逐渐完整显现出房间的轮廓

<table>
  <tr>
    <td style="border: 10px solid black; padding: 0;">
      <img src="https://github.com/user-attachments/assets/52d1aac5-6ef3-4a3a-86b3-acbfc9eb5849" width="80%">
    </td>
  </tr>
</table>

## 3.上机测试，串口通信或px4飞控定点飞行

### 3.1若机器人主控使用单片机或其他可串口通信的设备，测试模块的串口输出坐标功能

模块接线如图：

<table>
  <tr>
    <td style="border: 10px solid black; padding: 0;">
      <img src="https://github.com/user-attachments/assets/bb067858-c273-4ac0-99c6-6213cdc414a2" width="100%">
    </td>
  </tr>
</table>

上电后，等待模块初始化10s，连接模块热点（密码12345678）

打开上位机，连接串口后，可以看见接接收到大量数据

<table>
  <tr>
    <td style="border: 10px solid black; padding: 0;">
      <img src="https://github.com/user-attachments/assets/1124699b-ce2e-4baf-92ec-0b602f79c968" width="80%">
    </td>
  </tr>
</table>

上位机从数据中解析出坐标，模块串口输出坐标功能测试成功

<table>
  <tr>
    <td style="border: 10px solid black; padding: 0;">
      <img src="https://github.com/user-attachments/assets/9423cab7-4ae7-4193-a62d-b089ecdb1421" width="80%">
    </td>
  </tr>
</table>

#### **通信协议格式**

**波特率115200，字节格式为8N1**

| 字节序号       | 名称      | 长度     | 说明        | 单位       | 备注        |
| ---------- | ------- | ------ | --------- | -------- | --------- |
| **Byte 0** | 帧头      | 1 byte | 固定 `0xAA` | —        | 起始标志      |
| **Byte 1** | X 高字节   | 1 byte | X 坐标高 8 位 | **cm**   | int16 高字节 |
| **Byte 2** | X 低字节   | 1 byte | X 坐标低 8 位 | **cm**   | int16 低字节 |
| **Byte 3** | Y 高字节   | 1 byte | Y 坐标高 8 位 | **cm**   | int16 高字节 |
| **Byte 4** | Y 低字节   | 1 byte | Y 坐标低 8 位 | **cm**   | int16 低字节 |
| **Byte 5** | Z 高字节   | 1 byte | Z 坐标高 8 位 | **cm**   | int16 高字节 |
| **Byte 6** | Z 低字节   | 1 byte | Z 坐标低 8 位 | **cm**   | int16 低字节 |
| **Byte 7** | roll 高字节 | 1 byte | 翻滚角高字节    | **°（度）** | int16 高字节 |
| **Byte 8** | roll 低字节 | 1 byte | 翻滚角低字节    | **°（度）** | int16 低字节 |
| **Byte 9** | pitch 高字节 | 1 byte | 俯仰角高字节    | **°（度）** | int16 高字节 |
| **Byte 10** | pitch 低字节 | 1 byte | 俯仰角低字节    | **°（度）** | int16 低字节 |
| **Byte 11** | yaw 高字节 | 1 byte | 航向角高字节    | **°（度）** | int16 高字节 |
| **Byte 12** | yaw 低字节 | 1 byte | 航向角低字节    | **°（度）** | int16 低字节 |
| **Byte 13** | 帧尾      | 1 byte | 固定 `0x0A` | —        | 结束标志      |

例如串口收到数据：
AA 00 64 FF CE 00 1E 00 0A FF FB 00 5A 0A

解析后得到： 
x = 100 cm，y = -50 cm，z = 30 cm ，roll  = 10° ，pitch = -5° ，yaw = 90°

[使用STM32单片机，串口接收并解析数据教程](https://github.com/weisama/slam_mode_book/blob/main/2.%E4%BD%BF%E7%94%A8STM32%E8%AF%BB%E5%8F%96slam_mode%E4%B8%B2%E5%8F%A3%E6%95%B0%E6%8D%AE%E5%B9%B6%E8%A7%A3%E6%9E%90.md)

### 3.2若机器人主控使用px4架构飞控（pixhawk），测试模块作为飞控的位置输入传感器

模块接线如图（以pixhawk 6c mini飞控为例）：

<table>
  <tr>
    <td style="border: 10px solid black; padding: 0;">
      <img src="https://github.com/user-attachments/assets/9d536db0-9f66-4be2-8aa1-75718c4331ee" width="100%">
    </td>
  </tr>
</table>

先在上位机设置模块输出方式为mavlink格式输出：

<table>
  <tr>
    <td style="border: 10px solid black; padding: 0;">
      <img src="https://github.com/user-attachments/assets/d47d3c60-e6f3-42ae-b555-c1eaefd5bf1b" width="80%">
    </td>
  </tr>
</table>

需准备一架可起飞的px4架构飞控的无人机，电脑下载上QGC

本教程以固件px4V1.13.3为例，飞控连接上QGC后设置参数如下：

<table>
  <tr>
    <td style="border: 10px solid black; padding: 0;">
      <img src="https://github.com/user-attachments/assets/62ecce61-c13e-4661-8cdc-dbde6f7e259c" width="100%">
    </td>
  </tr>
</table>

<table>
  <tr>
    <td style="border: 10px solid black; padding: 0;">
      <img src="https://github.com/user-attachments/assets/a803d799-19e6-420e-9244-278c5b77cad5" width="100%">
    </td>
  </tr>
</table>



| 参数名称 | 设置值 | 说明 |
|---------|--------|------|
| MAV_1_CONFIG | TELLEM2 | 将 MAVLink 第 1 通道映射到飞控的 TELEM2 接口 |
| MAV_1_MODE | Onboard | 设定为 Onboard 模式，用于连接模块 |
| SER_TEL2_BAUD | 115200 8N1 | 设定 TELEM2 串口波特率为 115200 bps，8 位数据位、无校验、1 位停止位 |
| MAV_1_RATE | 0 | 设定 MAVLink 通道 1 的数据速率（bytes/s），0 表示由飞控自适应 |
| EKF2_AID_MASK | 24 | EKF2 融合辅助源掩码：24=16+8，启用模块输入的位置（EV_POS）与偏航（EV_YAW） |
| EKF2_EVP_NOISE | 0.1 | 默认外部位置观测噪声（m） |
| EKF2_EVA_NOISE | 2.56 | 默认外部角度（偏航）观测噪声（deg） |
| EKF2_EV_DELAY | 175 | 默认外部数据相对 IMU 的延迟补偿（ms） |
| EKF2_HGT_MODE | 2 | 高度估计源：0=气压计，1=GPS，2=外部视觉，3=激光测距仪 |

设置参数后断电重连飞控确保参数生效
给模块上电，等待模块初始化10s，可在QGC的mavlink控制器中看见模块传给飞控的数据：

<table>
  <tr>
    <td style="border: 10px solid black; padding: 0;">
      <img src="https://github.com/user-attachments/assets/67a01143-6a5d-4e31-a5b1-8bfa62b4358a" width="100%">
    </td>
  </tr>
</table>

QGC中可以把飞控模式设置为定点

<table>
  <tr>
    <td style="border: 10px solid black; padding: 0;">
      <img src="https://github.com/user-attachments/assets/89e9e345-122c-484c-b3d0-87038eea847c" width="100%">
    </td>
  </tr>
</table>

无人机已实现位置闭环，可起飞测试定点效果
